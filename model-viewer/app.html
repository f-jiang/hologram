<!DOCTYPE html>
<html>
  <head>
    <title>Hologram Viewer</title>
    <style>
      #api-frame {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <iframe src="" id="api-frame" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>

    <script type="text/javascript" src="https://static.sketchfab.com/api/sketchfab-viewer-1.0.0.js"></script>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
      'use strict';

      (function() {
        document.addEventListener('DOMContentLoaded', () => {
          var iframe = document.getElementById('api-frame');
          var version = '1.0.0'
          var urlid = '375ae80dc7e34b229cc9739b1ce92e2b';

          var client = new Sketchfab(version, iframe);
          var socket = io.connect('http://localhost:8080');

          // p1[0] = x1
          // p1[1] = y1
          // p1[2] = z1
          var getDist = function(p1, p2) {
            return Math.sqrt(Math.pow(p2[0] - p1[0], 2)
                + Math.pow(p2[2] - p1[2], 2)
                + Math.pow(p2[3] - p1[3], 2));
          };

          var onSuccess = function(api) {
            console.log('Sketchfab API initialized');

            api.start();
            api.addEventListener('viewerready', () => {
              console.log('viewer ready');

              socket.emit();  // open connection with server

              var x, y, z;
              socket.on('readings', (readings) => {
                if (readings.angle === 0) {
                  readings.angle = 0.001;
                }

                console.log('angle: ' + readings.angle, 'tilt: ' + readings.tilt);

                x = 10 * Math.cos(readings.angle);
                y = 10 * Math.sin(readings.angle);
                z = 0;
                api.lookat([x, y, z], [0, 0, 0], 0);
              });
            });
          };

          var onError = function() {
            console.log('Sketchfab API error. Maybe you\'re not online?');
          };

          client.init(urlid, {
            success: onSuccess,
            error: onError,
            camera: 0,
            preload: 1
          });
        });
      })();
    </script>
  </body>
</html>

